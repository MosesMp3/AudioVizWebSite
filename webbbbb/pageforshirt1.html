<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="page1.css">
</head>

<a href="index.html">
  <img src="blacklogo.png" class="title">
</a>

  <img src="Myshirt1.png" class="product" id="Shirt0">
  <div>
      <h1 style="color: #ffffff;"class="shirt1title">dog.jpg</h1>
  </div>
</a>

        <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Welcome to Collective">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css" />
  <!-- <script type="text/javascript" src="../lib/butterchurn.js"></script> -->
  <script type="text/javascript" src="https://unpkg.com/lodash"></script>
  <script type="text/javascript" src="https://unpkg.com/butterchurn"></script>
  <script type="text/javascript" src="https://unpkg.com/butterchurn-presets"></script>
  <script type="text/javascript" src="https://unpkg.com/butterchurn-presets/lib/butterchurnPresetsExtra.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  
  <title>Collective</title>
</head>

  <img class="titlepic"  src="blacklogo.png">




  <div style="position: absolute;
  color: rgb(255, 255, 255);
  top: 40%;
  left: 49%;
  transform: translate(-50%, -50%);
  z-index: 10;" class="buttons">
    <select id="fileSelect">
      <option value="1">Small</option>
      <option value="2">Medium</option>
      <option value="3">Large</option>
    </select>
  </div>
  
  <div style="position: absolute;
  top: 45%;
  left: 49%;
  transform: translate(-50%, -50%);
  z-index: 10" id="buyButtonContainer"></div>
  
  <script>
  var audioContext;
  var player;
  var source;
  
  function initPlayer(url) {
    if (audioContext === undefined) {
      audioContext = new AudioContext();
    } else if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
  
    player = new Audio();
    player.src = url;
    player.preload = 'auto';
    player.crossOrigin = 'anonymous';
  
    source = audioContext.createMediaElementSource(player);
    source.connect(audioContext.destination);
  
    player.play();
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    var fileSelect = document.getElementById('fileSelect');
    var buyButtonContainer = document.getElementById('buyButtonContainer');
    
    fileSelect.addEventListener('change', function() {
      var selectedValue = this.value;
      buyButtonContainer.innerHTML = ''; // Clear previous content
      
      if (selectedValue === "1") {
        var script = document.createElement('script');
        script.src = "https://js.stripe.com/v3/buy-button.js";
    
        var stripeBuyButton = document.createElement('stripe-buy-button');
        stripeBuyButton.setAttribute('buy-button-id', 'buy_btn_1NB3dqLs92MiXxqKjuK1JDfi');
        stripeBuyButton.setAttribute('publishable-key', 'pk_live_51N9CmwLs92MiXxqK4bzoyTfcF3QmecedUBaoGTYX0KVk8Yt5JNRlaklmzwL2VvY0wvqzBmD1LGlcSmsptm47XozQ00tkLBweHV');
    
        buyButtonContainer.appendChild(script);
        buyButtonContainer.appendChild(stripeBuyButton);
      }
      if (selectedValue === "2") {
      var mediumScript = document.createElement('script');
      mediumScript.async = true;
      mediumScript.src = "https://js.stripe.com/v3/buy-button.js";
  
      var mediumStripeBuyButton = document.createElement('stripe-buy-button');
      mediumStripeBuyButton.setAttribute('buy-button-id', 'buy_btn_1NB3YcLs92MiXxqKmfB7E9CY');
      mediumStripeBuyButton.setAttribute('publishable-key', 'pk_live_51N9CmwLs92MiXxqK4bzoyTfcF3QmecedUBaoGTYX0KVk8Yt5JNRlaklmzwL2VvY0wvqzBmD1LGlcSmsptm47XozQ00tkLBweHV');
  
      buyButtonContainer.appendChild(mediumScript);
      buyButtonContainer.appendChild(mediumStripeBuyButton);
    }
    if (selectedValue === "3") {
      var largeScript = document.createElement('script');
      largeScript.async = true;
      largeScript.src = "https://js.stripe.com/v3/buy-button.js";
  
      var largeStripeBuyButton = document.createElement('stripe-buy-button');
      largeStripeBuyButton.setAttribute('buy-button-id', 'buy_btn_1NB3UkLs92MiXxqK2VUziNwM');
      largeStripeBuyButton.setAttribute('publishable-key', 'pk_live_51N9CmwLs92MiXxqK4bzoyTfcF3QmecedUBaoGTYX0KVk8Yt5JNRlaklmzwL2VvY0wvqzBmD1LGlcSmsptm47XozQ00tkLBweHV');
  
      buyButtonContainer.appendChild(largeScript);
      buyButtonContainer.appendChild(largeStripeBuyButton);
    }
  });
});
  </script>


  <script>
    window.onload = function() {
    var context = new AudioContext();
      
    }
  </script>
  <style>
    .titlepic {
    z-index: 9;
    width: 40vw;
    height: 40vh;
    position: absolute;
    top: -15%;
    left: 29%;
    
    }

    html {
      background-color: rgb(0, 0, 0);
    }
    #canvas:-moz-full-screen {
      width: 100%;
      height: 100%;
    }

    #canvas:-webkit-full-screen {
      width: 100%;
      height: 100%;
    }

    #canvas:-ms-fullscreen {
      width: 100%;
      height: 100%;
    }

    #canvas:fullscreen {
      width: 100%;
      height: 100%;
    }

    #presetSelect {
      max-width: 300px;
    }

    #presetCycleLength {
      width: 50px;
    }
  </style>
  <script>
    $(function() {
    var visualizer = null;
    var rendering = false;
    var audioContext = null;
    var sourceNode = null;
    var delayedAudible = null;
    var cycleInterval = null;
    var presets = {};
    var presetKeys = [];
    var presetIndexHist = [];
    var presetIndex = 0;
    var presetCycle = true;
    var presetCycleLength = 15000;
    var presetRandom = true;
    var canvas = document.getElementById('buttercanvas');

    function connectToAudioAnalyzer(sourceNode) {
      if (delayedAudible) {
        delayedAudible.disconnect();
      }
      delayedAudible = audioContext.createDelay();
      delayedAudible.delayTime.value = 0.26;
      sourceNode.connect(delayedAudible)
      delayedAudible.connect(audioContext.destination);
      visualizer.connectAudio(delayedAudible);
    }

    function startRenderer() {
      var vrscene = document.querySelector('a-scene');
      requestAnimationFrame(() => startRenderer());
      visualizer.render();
    }

    function playBufferSource(buffer) {
      if (!rendering) {
        rendering = true;
        startRenderer();
      }
      if (sourceNode) {
        sourceNode.disconnect();
      }
      sourceNode = audioContext.createBufferSource();
      sourceNode.buffer = buffer;
      connectToAudioAnalyzer(sourceNode);
      sourceNode.start(0);
    }


    
    function loadLocalFiles(files, index = 0) {
        audioContext.resume();

        var reader = new FileReader();
        reader.onload = (event) => {
          audioContext.decodeAudioData(
            event.target.result,
            (buf) => {
              playBufferSource(buf);

              setTimeout(() => {
                if (files.length > index + 1) {
                  loadLocalFiles(files, index + 1);
                } else {
                  sourceNode.disconnect();
                  sourceNode = null;
                  $("#audioSelectWrapper").css('display', 'block');
                }
              }, buf.duration * 1000);
            }
          );
        };

        var file = files[index];
        reader.readAsArrayBuffer(file);
      }
  
    



    function connectMicAudio(sourceNode, audioContext) {
      audioContext.resume();
      var gainNode = audioContext.createGain();
      gainNode.gain.value = 1.25;
      sourceNode.connect(gainNode);
      visualizer.connectAudio(gainNode);
      startRenderer();
    }

    function nextPreset(blendTime = 5.7) {
      presetIndexHist.push(presetIndex);
      var numPresets = presetKeys.length;
      if (presetRandom) {
        presetIndex = Math.floor(Math.random() * presetKeys.length);
      } else {
        presetIndex = (presetIndex + 1) % numPresets;
      }
      visualizer.loadPreset(presets[presetKeys[presetIndex]], blendTime);
      document.querySelector('#presetSelect').value = presetIndex
    }

    function prevPreset(blendTime = 5.7) {
      var numPresets = presetKeys.length;
      if (presetIndexHist.length > 0) {
        presetIndex = presetIndexHist.pop();
      } else {
        presetIndex = ((presetIndex - 1) + numPresets) % numPresets;
      }
      visualizer.loadPreset(presets[presetKeys[presetIndex]], blendTime);
      document.querySelector('#presetSelect').value = presetIndex
    }

    function restartCycleInterval() {
      if (cycleInterval) {
        clearInterval(cycleInterval);
        cycleInterval = null;
      }
      if (presetCycle) {
        cycleInterval = setInterval(() => nextPreset(2.7), presetCycleLength);
      }
    }
    document.addEventListener('keydown', (e) => {
      if (e.which === 32 || e.which === 39) {
        nextPreset();
      } else if (e.which === 8 || e.which === 37) {
        prevPreset();
      } else if (e.which === 72) {
        nextPreset(0);
      }
    })
   

    $('#presetSelect').change((evt) => {
        presetIndexHist.push(presetIndex);
        presetIndex = parseInt($('#presetSelect').val());
        visualizer.loadPreset(presets[presetKeys[presetIndex]], 5.7);
      });

      $('#presetCycle').change(() => {
        presetCycle = $('#presetCycle').is(':checked');
        restartCycleInterval();
      });

      $('#presetCycleLength').change((evt) => {
        presetCycleLength = parseInt($('#presetCycleLength').val() * 1000);
        restartCycleInterval();
      });

      $('#presetRandom').change(() => {
        presetRandom = $('#presetRandom').is(':checked');
      });

      $("#localFileBut").click(function() {
        $("#audioSelectWrapper").css('display', '');

        var fileSelector = $('<input type="file" accept="audio/*" multiple />');

        fileSelector[0].onchange = function(event) {
          loadLocalFiles(fileSelector[0].files);
        }

        fileSelector.click();
      });

      $("#micSelect").click(() => {
        $("#audioSelectWrapper").css('display', '');

        navigator.getUserMedia({ audio: true }, (stream) => {
          var micSourceNode = audioContext.createMediaStreamSource(stream);
          connectMicAudio(micSourceNode, audioContext);
        }, (err) => {
          console.log('Error getting audio stream from getUserMedia');
        });
      });

      function initPlayer() {
        var player = new Audio();
        var playlist = [{
          name: 'Help us',
          slug: 'nightwave',
          src: "The Hellp4up7up.mp3"
        }, ];
        player.src = playlist[0].src;
        player.preload = 'auto';
        player.crossOrigin = 'anonymous';
        audioContext = new AudioContext();



        //source = audioContext.createMediaElementSource( player );
        //source.connect( audioContext.destination );
        navigator.getUserMedia({
          audio: true
        }, (player) => {
          var stream = audioContext.createMediaStreamSource(player);
          connectMicAudio(stream, audioContext);
          
        }, (err) => {
          console.log('Error getting audio stream from getUserMedia');
        });
        presets = {}; 

        if (window.butterchurnPresets) {
          Object.assign(presets, butterchurnPresets.getPresets());
        }
        if (window.butterchurnPresetsExtra) {
          Object.assign(presets, butterchurnPresetsExtra.getPresets());
        }
        presets = _(presets).toPairs().sortBy(([k, v]) => k.toLowerCase()).fromPairs().value();
        presetKeys = _.keys(presets);
        presetIndex = Math.floor(Math.random() * presetKeys.length);
        var presetSelect = document.getElementById('presetSelect');
        for (var i = 0; i < presetKeys.length; i++) {
          var opt = document.createElement('option');
          opt.innerHTML = presetKeys[i].substring(0, 60) + (presetKeys[i].length > 60 ? '...' : '');
          opt.value = i;
          presetSelect.appendChild(opt);
        }
        visualizer = butterchurn.default.createVisualizer(audioContext, canvas, {
          width: 1920,
          height: 1080,
          pixelRatio: window.devicePixelRatio || 1,
          textureRatio: 1,
        });
        nextPreset(0);
        cycleInterval = setInterval(() => nextPreset(2.7), presetCycleLength);
      }
      let xrSession = null

      function onWindowAnimationFrame(time) {
        window.requestAnimationFrame(onWindowAnimationFrame)
        // This may be called while an immersive session is running on some devices,
        // such as a desktop with a tethered headset. To prevent two loops from
        // rendering in parallel, skip drawing in this one until the session ends.
        if (!xrSession) {
          renderFrame(time, null)
        }
      }
      // The window animation loop can be started immediately upon the page loading.
      window.requestAnimationFrame(onWindowAnimationFrame)
      function onXRAnimationFrame(time, xrFrame) {
        xrSession.requestAnimationFrame(onXRAnimationFrame)
        renderFrame(time, xrFrame)
      }

      function renderFrame(time, xrFrame) {
        // Shared rendering logic.
      }

      function onXRSessionEnded() {
        xrSession = null
      }
      initPlayer();
    });
  </script>
</head>
<body>
    <canvas style="filter: brightness(.5); width: 100vw; height: 100vh;" id="buttercanvas" width="1920" height="1080"></canvas>




  <div id="mainWrapper">
    <div id="audioSelectWrapper">
      <div id="localFileBut">
        <span style="color: #ffffff;">Load local files</span>
      </div>
      <div id="micSelect">
        <span style="color: #ffffff;">Use Mic</span>
      </div>
    </div>
    <div id="presetControls">
      <div>Preset: <select id="presetSelect"></select>
      </div>
      <div>Cycle: <input type="checkbox" id="presetCycle" checked></input>
        <input type="number" id="presetCycleLength" step="1" value="15" min="1"></input>
      </div>
      <div>Random: <input type="checkbox" id="presetRandom" checked></input>
      </div>
    </div>
  </div>
</body>
</html>